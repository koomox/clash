package clash

import (
	"encoding/base64"
	"github.com/koomox/ext"
)

type Config struct {
	rules   []byte
	prefix  []byte
	isValid bool
}

var (
	current   = &Config{isValid: false}
	rawRules  = "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"
	rawPrefix = "eJxUkMFugzAMhu+R8g5W1Wvo6Napykts2mk7pmBaVjfJnEDH208hoWKKEObzL/LZwTXXoLzjqKF+2h+OUhgid1dkrIbOUEApbq5FDTwQSkHurAhHJA297ZwUvR9fH8nWBi0FAFpzInxgAGtuGJBH5LkPoKCuX6rVs+BjNZ/lM1LQu11rQ8XDaer6cKkaq4+H5yVwidGnSF3NJ0XVz4A8SSGFZ/fbY3ZSs4SGTWT3bewm/yBOHjVklEnRhG0uMswb2qZXASaEu+M2wVLmhiFvy4yz3n5Vx+iTZ7nn2nvVIEc1IvfdlCwGXKwndWY3+P/q7x9vn19r74CEzWK0mrXsrkz1FwAA//+AgYVJ"
)

func deCompress(raw string) (b []byte, err error) {
	if b, err = base64.RawStdEncoding.DecodeString(raw); err != nil {
		return
	}
	return ext.NewEncoding().DeCompress(b)
}

func Initial() {
	if current.isValid {
		return
	}
	b, err := deCompress(rawRules)
	if err != nil {
		return
	}
	current.rules = b
	if b, err = deCompress(rawPrefix); err != nil {
		return
	}
	current.prefix = b
	current.isValid = true
}
